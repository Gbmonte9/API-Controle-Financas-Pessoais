html
  head
    title Nova Transação
  body
    h1 Nova Transação

    nav
      ul
        li: a(href="/perfil") Perfil
        li: a(href="/transacoes") Transações
        li: a(href="/transacoes/nova") Fazer Transações
        li: a(href="/relatorios") Relatórios
        li: a(href="/") Sair

    form
      div
        label(for="tipo") Tipo:
        select(name="tipo" id="tipo" required)
          option(value="receita") Receita
          option(value="despesa") Despesa

      div
        label(for="descricao") Descrição:
        input(type="text" id="descricao")

      div
        label(for="valor") Valor:
        input(type="number" step="0.01" id="valor")

      div
        label(for="categoria") Categoria:
        input(type="text" id="categoria")

      div
        button(type="button" id="btnCadastrarTransacao") Salvar

    p#message

    script.
      document.addEventListener('DOMContentLoaded', function () {
        const btnCadastrar = document.getElementById('btnCadastrarTransacao');
        const message = document.getElementById('message');

        btnCadastrar.addEventListener('click', async function () {
          const tipo = document.getElementById('tipo').value;
          const descricao = document.getElementById('descricao').value;
          const valor = document.getElementById('valor').value;
          const categoria = document.getElementById('categoria').value;
          const token = localStorage.getItem('token');

          try {
            const response = await fetch('/transacao', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
              },
              body: JSON.stringify({ tipo, descricao, valor, categoria })
            });

            const data = await response.json();

            if (!response.ok) {
              alert(data.erro || 'Erro no cadastro');
              return;
            }

            alert('Cadastro realizado com sucesso!');
          } catch (err) {
            console.error(err);
            alert('Erro de conexão com o servidor');
          }
        });
      });